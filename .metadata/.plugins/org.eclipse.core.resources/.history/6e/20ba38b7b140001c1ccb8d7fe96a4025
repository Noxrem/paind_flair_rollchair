/*
 * architecture.c
 *
 *  Created on: 30.09.2021
 *      Author: Noxrem
 */

#include "cycle_counter.h"
#include <stdint.h>
#include <stdio.h>
#include "delay.h"

static int32_t startCounter, stopCounter;

void architecture(void)
{
	CCounter_Init();	// cycle_counter init

	CCOUNTER_START();
	__asm("nop");
	CCOUNTER_STOP();
	CCounter_LogTime("1x nop");
	//printf("1x nop: %d\n", CCounter_stopCounter-CCounter_startCounter);

	CCOUNTER_START();
	__asm("nop");
	__asm("nop");
	CCOUNTER_STOP();
	CCounter_LogTime("2x nop");
	//printf("2x nop: %d\n", CCounter_stopCounter-CCounter_startCounter);

	startCounter = CCOUNTER_GetCycleCounter();
	__asm("nop");
	stopCounter = CCOUNTER_GetCycleCounter();
	printf("1x different nop: %d\n", stopCounter-startCounter);

	startCounter = CCOUNTER_GetCycleCounter();
	__asm("nop");
	__asm("nop");
	stopCounter = CCOUNTER_GetCycleCounter();
	printf("2x different nop: %d\n", stopCounter-startCounter);

	// 2.2.3
	CCOUNTER_START();
	printf("Hello World\n");
	CCOUNTER_STOP();
	CCounter_LogTime("printf");

	CCOUNTER_START();
	puts("Hello World\n");
	CCOUNTER_STOP();
	CCounter_LogTime("puts");

	CCOUNTER_START();
	const char *str = "Hello World\n";
	size_t len = strlen(str);
	while(len>0)
	{
		putchar(*str++);
		len--;
	}
	CCOUNTER_STOP();
	CCounter_LogTime("putchar");

	// 2.2.4
	CCOUNTER_START();
	delay(1000);
	CCOUNTER_STOP();
	CCounter_LogTime("delay 1s");
}
